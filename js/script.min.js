var tabCart=document.querySelector(".main-header .cart");tabBookmark=document.querySelector(".main-header .bookmark"),counterCart=tabCart.querySelector("span"),counterBookmark=tabBookmark.querySelector("span");var currentDataSlide,controlsSlider,currentDataService,currentPopup,formMessage,inputName,inputEmail,inputText,rangeScale,rangeBar,toogleMin,toogleMax,slider=document.querySelector(".slider"),listCatalog=document.querySelector(".catalog-list"),listServices=document.querySelector(".services-list"),overlay=document.querySelector(".overlay"),btnShowMap=document.querySelector(".contacts-map"),popupMap=document.querySelector(".modal-map"),btnCreateMessage=document.querySelector(".btn-create-message"),popupMessage=document.querySelector(".modal-message"),popupInformer=document.querySelector(".modal-informer"),rangeСontrols=document.querySelector(".range-controls"),inputMinPrice=document.querySelector(".filter-price-from"),inputMaxPrice=document.querySelector(".filter-price-to"),isStorageSupport=!0,numberCart=Number(counterCart.textContent),numberBookmark=Number(counterBookmark.textContent),storageName="",storageEmail="",minValuePrice=0,maxValuePrice=35e3,rublesPerRixel=250;popupMessage&&(formMessage=popupMessage.querySelector(".modal-message-form"),inputName=formMessage.querySelector(".message-input-name"),inputEmail=formMessage.querySelector(".message-input-email"),inputText=formMessage.querySelector(".message-input-text"));try{storageName=localStorage.getItem("technomartMessageName"),storageEmail=localStorage.getItem("technomartMessageEmail")}catch(e){isStorageSupport=!1}if(slider&&(currentDataSlide=slider.querySelector(".slide-active").getAttribute("data-slide"),(controlsSlider=slider.querySelector(".slider-controls")).addEventListener("click",clickControlsSlider),controlNavigationBack=slider.querySelector(".control-navigation-back"),controlNavigationBack.addEventListener("click",clickControlNavigationSlide),controlNavigationNext=slider.querySelector(".control-navigation-next"),controlNavigationNext.addEventListener("click",clickControlNavigationSlide)),listCatalog&&listCatalog.addEventListener("click",clickCatalog),listServices&&(currentDataService=listServices.querySelector(".service-active").getAttribute("data-service"),listServices.addEventListener("click",clickSliderServices)),btnCreateMessage&&btnCreateMessage.addEventListener("click",createMessage),btnShowMap&&btnShowMap.addEventListener("click",function(e){e.preventDefault(),showPopup(popupMap)}),rangeСontrols){var currentToogle;rangeScale=rangeСontrols.querySelector(".scale"),rangeBar=rangeСontrols.querySelector(".bar"),toogleMin=rangeСontrols.querySelector(".toogle-min"),toogleMax=rangeСontrols.querySelector(".toogle-max");var currentToogleCoords,shiftX,leftEdge,rightEdge,widthRange=getWidthElement(rangeСontrols),widthRangeScale=getWidthElement(rangeScale),widthRangeBar=getWidthBar(),widthToogleMin=getWidthElement(toogleMin),widthToogleMax=getWidthElement(toogleMax),maxWidthRangeBar=widthRangeScale-widthToogleMin-widthToogleMax,rangeCoords=getCoords(rangeСontrols),baseEdge=(widthRange-widthRangeScale)/2;toogleMin.addEventListener("mousedown",mousedownToogle),toogleMax.addEventListener("mousedown",mousedownToogle)}function mousedownToogle(e){currentToogle=e.target,currentToogleCoords=getCoords(currentToogle),shiftX=e.pageX-currentToogleCoords.left,currentToogle.addEventListener("dragstart",dragstartToogle),document.addEventListener("mousemove",moveToogle),document.addEventListener("mouseup",mouseupToogle)}function dragstartToogle(e){e.preventDefault()}function moveToogle(e){var t=e.pageX-shiftX-rangeCoords.left;rightEdge=currentToogle===toogleMin?(leftEdge=baseEdge,getCoords(toogleMax).left-rangeCoords.left-widthToogleMin):(leftEdge=getCoords(toogleMin).right-rangeCoords.left,widthRange-baseEdge-widthToogleMax),t<leftEdge?t=leftEdge:rightEdge<t&&(t=rightEdge),currentToogle.style.left=t+"px",setBar(),currentToogle===toogleMin?setValueToInput(inputMinPrice,getMinPriceForInput()):setValueToInput(inputMaxPrice,getMaxPriceForInput())}function mouseupToogle(e){currentToogle.removeEventListener("dragstart",dragstartToogle),document.removeEventListener("mousemove",moveToogle),document.removeEventListener("mouseup",mouseupToogle)}function getCoords(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset,right:t.right+pageXOffset}}function getWidthElement(e){return e.offsetWidth}function getWidthBar(){return getCoords(toogleMax).left-getCoords(toogleMin).right}function getLeftEdgeAtBar(){return getCoords(rangeBar).left-rangeCoords.left-baseEdge-widthToogleMin}function getMinPriceForInput(){return getLeftEdgeAtBar()*rublesPerRixel}function getMaxPriceForInput(){return(getLeftEdgeAtBar()+widthRangeBar)*rublesPerRixel}function setBar(){widthRangeBar=getWidthBar(),rangeBar.style.width=widthRangeBar+"px",rangeBar.style.left=getCoords(toogleMin).right-rangeCoords.left+"px"}function selectValueInput(e){0===Number(e.target.value)&&e.target.select()}function changeInput(e){var t=e.target,r=Number(t.value);maxValuePrice<=r?(inputMinPrice.value=maxValuePrice,inputMaxPrice.value=maxValuePrice):r<=minValuePrice?(inputMinPrice.value=minValuePrice,inputMaxPrice.value=minValuePrice):t===inputMinPrice&&r>Number(inputMaxPrice.value)?inputMaxPrice.value=maxValuePrice:t===inputMaxPrice&&r<Number(inputMinPrice.value)&&(inputMinPrice.value=minValuePrice),setCoordsToogles()}function setCoordsToogles(){var e=Number(inputMinPrice.value)/rublesPerRixel+baseEdge,t=Number(inputMaxPrice.value)/rublesPerRixel+widthToogleMin+baseEdge;toogleMin.style.left=Math.round(e)+"px",toogleMax.style.left=Math.round(t)+"px",setBar()}function clickControlsSlider(e){var t=e.target.getAttribute("data-slide");e.target.classList.contains("control-page")&&t!==currentDataSlide&&(e.preventDefault(),replaceActiveSlide(t),replaceActiveControlPageSlider(t),currentDataSlide=t)}function clickControlNavigationSlide(e){e.preventDefault();var t,r,o=slider.querySelector(".slider-item[data-slide="+currentDataSlide+"]");"back"===e.target.getAttribute("data-slide")?(t=o.previousElementSibling)||(t=o.parentElement.lastElementChild):(t=o.nextElementSibling)||(t=o.parentElement.firstElementChild),replaceActiveSlide(r=t.getAttribute("data-slide")),replaceActiveControlPageSlider(r),currentDataSlide=r}function replaceActiveSlide(e){slider.querySelector(".slider-item[data-slide="+currentDataSlide+"]").classList.remove("slide-active"),slider.querySelector(".slider-item[data-slide="+e+"]").classList.add("slide-active")}function replaceActiveControlPageSlider(e){controlsSlider.querySelector(".control-page[data-slide="+currentDataSlide+"]").classList.remove("control-page-active"),controlsSlider.querySelector(".control-page[data-slide="+e+"]").classList.add("control-page-active")}function clickCatalog(e){e.preventDefault(),e.target.classList.contains("btn-add-cart")?(numberCart=incCounterTab(numberCart,counterCart),tabCart.classList.add("cart-full"),showPopup(popupInformer)):e.target.classList.contains("btn-add-bookmark")&&(numberBookmark=incCounterTab(numberBookmark,counterBookmark),tabBookmark.classList.add("bookmark-full"))}function clickSliderServices(e){var t=e.target.closest(".service-item").getAttribute("data-service");e.target.hasAttribute("href")&&t!==currentDataService&&(e.preventDefault(),replaceActiveLinkService(t),replaceActiveServiceInfo(t),currentDataService=t)}function replaceActiveLinkService(e){var t=listServices.querySelector(".service-item[data-service="+currentDataService+"]"),r=t.querySelector("a");t.classList.remove("service-active"),r.setAttribute("href",currentDataService+".html");var o=listServices.querySelector(".service-item[data-service="+e+"]"),a=o.querySelector("a");o.classList.add("service-active"),a.removeAttribute("href")}function replaceActiveServiceInfo(e){document.querySelector(".service-info[data-service="+currentDataService+"]").classList.remove("service-info-show"),document.querySelector(".service-info[data-service="+e+"]").classList.add("service-info-show")}function createMessage(e){e.preventDefault(),showPopup(popupMessage),setValueToInput(inputName,storageName),setValueToInput(inputEmail,storageEmail),inputText.focus(),storageName?storageEmail||inputEmail.focus():inputName.focus(),formMessage.addEventListener("submit",sendMessage)}function sendMessage(e){inputName.value&&inputEmail.value&&inputText.value?(isStorageSupport&&(localStorage.setItem("technomartMessageName",inputName.value),localStorage.setItem("technomartMessageEmail",inputEmail.value)),hidePopup(popupMessage)):(popupMessage.classList.remove("modal-error"),popupMessage.offsetWidth=popupMessage.offsetWidth,popupMessage.classList.add("modal-error"),e.preventDefault())}function showPopup(e){overlay.classList.add("overlay-show"),overlay.addEventListener("click",onClickOverlay),(currentPopup=e).classList.add("modal-show");var t=e.querySelector(".btn-close"),r=e.querySelector(".btn-continue-shopping");t&&t.addEventListener("click",onClickBtnClosePopup),r&&r.addEventListener("click",onClickBtnClosePopup),window.addEventListener("keydown",keydownClosePopup)}function onClickBtnClosePopup(e){e.preventDefault(),hidePopup(currentPopup)}function keydownClosePopup(e){27===e.keyCode&&(e.preventDefault(),currentPopup&&hidePopup(currentPopup))}function onClickOverlay(e){e.preventDefault(),hidePopup(currentPopup)}function hidePopup(e){e.classList.remove("modal-show"),overlay.classList.remove("overlay-show"),e.classList.remove("modal-error"),formMessage.removeEventListener("submit",sendMessage),window.removeEventListener("keydown",keydownClosePopup),overlay.removeEventListener("click",onClickOverlay);var t=e.querySelector(".btn-close"),r=e.querySelector(".btn-continue-shopping");t&&t.removeEventListener("click",onClickBtnClosePopup),r&&r.removeEventListener("click",onClickBtnClosePopup),currentPopup=null}function setValueToInput(e,t){e&&(e.value=t)}function incCounterTab(e,t){return e++,t.textContent=e}inputMinPrice&&(inputMinPrice.type="text",inputMinPrice.style.paddingRight="16px",inputMinPrice.addEventListener("focus",selectValueInput),inputMinPrice.addEventListener("change",changeInput)),inputMaxPrice&&(inputMaxPrice.type="text",inputMaxPrice.style.paddingRight="16px",inputMaxPrice.addEventListener("focus",selectValueInput),inputMaxPrice.addEventListener("change",changeInput));